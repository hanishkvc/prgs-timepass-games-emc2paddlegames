<html>
	<head>
		<title> E=MC^2 of Paddle Games </title>
	</head>
	<body>
		<div id="top">
		<h2> E=MC^2 of Paddle Games </h2>
		<withloveto> Thanks for all the pizzas!!! Shreya, Kunju, Nanda, Chinnu </withloveto>
		</div>
		<div id="main">
			<canvas id="canvas" width=640> What Canvas??? No no no noo noo noooooo </canvas>
		</div>
		<div id="controls">
			<p id="status"> Save Nature Save Earth </p>
		</div>
	<script>
		var gTimer;
		var gStatus;
		var gCanvas;
		var gCtxt;
		var bX, bY;
		const bW = 20;
		const bH = 20;
		var bXD = 0, bYD = 2;
		const bXAdj = Math.round(bW/2, 0);
		var pX, bY;
		const pW = 40, pH = 5, pD = 10;
		const pXAdj = Math.round(pW/2, 0);
		var gArcRad = 10;
		const LAZY_REPEAT = 2;
		var gRepeat = LAZY_REPEAT;


		function update_status(msg) {
			gStatus.textContent = msg;
		}


		function display_me() {
			gCtxt.fillStyle = "#208080";
			gCtxt.fillRect(0, 0, gCanvas.width, gCanvas.height);
			gCtxt.fillStyle = "#802020";
			gCtxt.fillRect(bX-bXAdj, bY, bW, bH);
			gCtxt.fillStyle = "#202020";
			gCtxt.fillRect(pX-pXAdj, pY, pW, pH);
		}


		function arc_out() {
			gCtxt.beginPath()
			gCtxt.arc(bX,bY,gArcRad,0,3.14,true);
			gArcRad += 5;
			gCtxt.fillStyle=`rgb( ${Math.random()*256}, ${Math.random()*256}, ${Math.random()*256})`;
			gCtxt.fill()
			if (gArcRad > 100) clearInterval(gTimer);
		}


		function next_frame() {
			bY += bYD;
			bX += bXD;
			if ((pY - bY) < pH) {
				update_status("INFO: Ball reached bottom");
				bD = bX - pX;
				if (Math.abs(bD) > pXAdj) {
					update_status(`Oops:Dropped the ball ${bD}, refresh to start over`);
					clearInterval(gTimer);
					gTimer = setInterval(arc_out, 100);
				} else {
					update_status(`INFO:Byalalu, ball has contacted paddle ${bD}`);
					bYD = -1*bYD;
					bD = Math.round(bD/8)
					if (bD === 0) {
						bXD = 0;
						gRepeat -= 1;
						if (gRepeat == 0) {
							update_status("ALERT: Meteriot on the way...");
						}
						if (gRepeat < 0) {
							bXD = 0.5 - Math.random();
							update_status("Run kid run...");
							gRepeat = LAZY_REPEAT;
						}
					} else if (bD > 0) {
						bXD = 0.4;
					} else {
						bXD = -0.4;
					}
				}
			}
			if ((bY < 0) && (bYD < 0)) {
				update_status("INFO: Ball reached top");
				bYD = -1*bYD;
			}
			if ((bX < 0) || (bX > gCanvas.width)) {
				update_status("Yeh Kya uha..., refresh to start over");
				clearInterval(gTimer);
			}
			display_me();
		}


		function handle_key(ev) {
			if (ev.key === "ArrowLeft") {
				pX -= pD;
				if (pX <= 0) pX = 0;
			} else if (ev.key === "ArrowRight") {
				pX += pD;
				if (pX >= gCanvas.width) pX = gCanvas.width;
			}
		}


		function init_me() {
			gStatus = document.getElementById("status");
			gCanvas = document.getElementById("canvas");
			gCtxt = gCanvas.getContext("2d");
			bX = Math.random()*gCanvas.width;
			bY = 0;
			pX = Math.random()*gCanvas.width;
			pY = gCanvas.height-10;
			gTimer = setInterval(next_frame, 50);
			window.onkeydown = handle_key;
		}


		document.addEventListener("DOMContentLoaded", (ev) => {
			init_me();
		});
	</script>

	</body>
</html>
